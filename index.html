<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九州夢幻冬旅 | Kyushu Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Nunito:wght@600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kyushu-sky': '#E0F2F1', // Winter sky
                        'kyushu-snow': '#F9FAFB', // Snow white
                        'ghibli-green': '#4A7c59', // Forest green
                        'ghibli-red': '#E57373', // Strawberry/Torii red
                        'ghibli-dark': '#2C3E50',
                    },
                    fontFamily: {
                        sans: ['Nunito', 'Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #E0F2F1; /* 延伸圖片底色 */
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        /* Custom Animations */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        .slide-up-enter-active {
            transition: all 0.3s ease-out;
        }
        .slide-up-enter-from {
            transform: translateY(20px);
            opacity: 0;
        }
    </style>
</head>
<body class="text-ghibli-dark antialiased min-h-screen relative">

<div id="app" class="max-w-md mx-auto bg-kyushu-snow min-h-screen relative shadow-2xl overflow-hidden pb-20">

    <header class="relative w-full h-[250px] z-10">
        <div class="absolute inset-0 w-full h-full overflow-hidden">
            <img :src="headerImage" alt="Kyushu Banner" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
        </div>
        
        <div class="absolute top-6 left-6 text-white drop-shadow-md">
            <h1 class="text-2xl font-black tracking-wide">九州福岡玩翻天</h1>
            <p class="text-sm opacity-90 font-medium">夢幻主題樂園 x 三大蟹 x 玩雪</p>
        </div>

        <div class="absolute bottom-12 right-4 flex space-x-2 z-20">
            <button v-for="tab in tabs" :key="tab.id" 
                @click="currentTab = tab.id"
                :class="['flex flex-col items-center justify-center w-14 h-14 rounded-2xl transition-all duration-300 shadow-lg transform active:scale-95 border-2', 
                currentTab === tab.id ? 'bg-white text-ghibli-green border-ghibli-green -translate-y-2' : 'glass text-white border-transparent hover:bg-white/90 hover:text-ghibli-green']">
                <i :class="tab.icon + ' text-xl mb-1'"></i>
                <span class="text-[10px] font-bold">{{ tab.name }}</span>
            </button>
        </div>
    </header>

    <main class="relative z-10 -mt-10 bg-kyushu-snow rounded-t-[3rem] min-h-[calc(100vh-210px)] px-5 pt-8 pb-24 transition-all duration-500">
        
        <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
            
            <div class="flex overflow-x-auto hide-scrollbar space-x-3 mb-6 pb-2">
                <div v-for="(day, index) in days" :key="index" 
                    @click="selectedDayIndex = index"
                    :class="['flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl cursor-pointer transition-all duration-300 border-2', 
                    selectedDayIndex === index ? 'bg-ghibli-green text-white border-ghibli-green shadow-lg transform scale-105' : 'bg-white text-gray-400 border-gray-100']">
                    <span class="text-xs font-bold uppercase">{{ day.weekday }}</span>
                    <span class="text-2xl font-black">{{ day.date }}</span>
                </div>
            </div>

            <div class="bg-gradient-to-r from-blue-100 to-blue-50 rounded-2xl p-4 mb-6 flex items-center justify-between shadow-sm border border-blue-100">
                <div class="flex items-center">
                    <div class="text-3xl text-yellow-400 mr-3"><i :class="weatherIcon"></i></div>
                    <div>
                        <div class="text-xs text-gray-500">今日天氣 (福岡)</div>
                        <div class="font-bold text-lg text-ghibli-dark">{{ currentTemp }}°C <span class="text-xs font-normal text-gray-500">體感 {{ parseInt(currentTemp) - 2 }}°C</span></div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-blue-500 font-bold bg-white px-2 py-1 rounded-full">降雪機率 20%</div>
                </div>
            </div>

            <div class="space-y-0 relative">
                <transition-group name="slide-up">
                    <div v-for="(item, index) in currentDayItinerary" :key="item.id" class="relative pl-6 pb-8 border-l-2 border-dashed border-gray-300 last:border-0">
                        
                        <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-white border-4 border-ghibli-green"></div>

                        <div v-if="index > 0" class="absolute -left-12 top-[-2rem] w-24 text-center">
                            <span class="bg-gray-100 text-[10px] text-gray-500 px-2 py-1 rounded-full shadow-sm flex items-center justify-center gap-1 mx-auto w-fit">
                                <i :class="getTransportIcon(item.transport)"></i> {{ item.travelTime }}
                            </span>
                        </div>
                        <div v-else class="absolute -left-12 top-[-2rem] w-24 text-center">
                             <span class="bg-blue-50 text-[10px] text-blue-500 px-2 py-1 rounded-full shadow-sm">
                                <i class="fa-solid fa-hotel"></i> 出發
                            </span>
                        </div>

                        <div @click="openMap(item.name)" class="bg-white rounded-2xl p-4 card-shadow relative overflow-hidden group active:scale-95 transition-transform cursor-pointer">
                            
                            <span :class="['absolute top-0 right-0 px-3 py-1 rounded-bl-2xl text-[10px] font-bold text-white', getCategoryColor(item.category)]">
                                {{ getCategoryLabel(item.category) }}
                            </span>

                            <div class="flex items-start gap-3 mt-1">
                                <div :class="['w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 text-white shadow-md', getCategoryColor(item.category)]">
                                    <i :class="getCategoryIcon(item.category)"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-lg leading-tight mb-1">{{ item.name }}</h3>
                                    
                                    <div v-if="item.category === 'flight'" class="bg-blue-50 rounded-lg p-2 mt-2 text-xs text-blue-800">
                                        <div class="flex justify-between font-bold mb-1">
                                            <span>{{ item.features.flightNo }}</span>
                                            <span>{{ item.features.airline }}</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span>{{ item.features.dep }}</span>
                                            <i class="fa-solid fa-plane text-gray-400 mx-2"></i>
                                            <span>{{ item.features.arr }}</span>
                                        </div>
                                    </div>

                                    <div v-else>
                                        <p v-if="item.hours" class="text-xs text-gray-500 mb-0.5"><i class="fa-regular fa-clock mr-1"></i> {{ item.hours }}</p>
                                        <p v-if="item.price" class="text-xs text-gray-500 mb-0.5"><i class="fa-solid fa-ticket mr-1"></i> {{ item.price }}</p>
                                        <p v-if="item.notes" class="text-xs text-gray-600 mt-2 bg-gray-50 p-2 rounded-lg border border-gray-100">
                                            <i class="fa-solid fa-circle-info text-ghibli-green mr-1"></i> {{ item.notes }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end mt-3 space-x-3 pt-2 border-t border-gray-100" @click.stop>
                                <button @click="moveItem(index, -1)" class="text-gray-400 hover:text-ghibli-green text-xs p-1"><i class="fa-solid fa-arrow-up"></i></button>
                                <button @click="moveItem(index, 1)" class="text-gray-400 hover:text-ghibli-green text-xs p-1"><i class="fa-solid fa-arrow-down"></i></button>
                                <button @click="editItem(item)" class="text-blue-400 hover:text-blue-600 text-xs p-1"><i class="fa-solid fa-pen"></i></button>
                                <button @click="confirmDelete(item.id)" class="text-red-300 hover:text-red-500 text-xs p-1"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                </transition-group>
            </div>

            <button @click="openAddModal" class="fixed bottom-6 right-6 w-14 h-14 bg-ghibli-dark text-white rounded-full shadow-2xl flex items-center justify-center text-2xl active:scale-90 transition-transform z-30 border-4 border-white">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'info'" class="animate-fade-in space-y-6">
            <h2 class="text-xl font-bold text-ghibli-dark mb-4">旅遊小幫手</h2>

            <div class="bg-white rounded-2xl p-5 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold"><i class="fa-solid fa-coins text-yellow-500 mr-2"></i>匯率換算</h3>
                    <span class="text-xs text-gray-400">匯率: {{ exchangeRate }}</span>
                </div>
                <div class="flex items-center space-x-2 bg-gray-50 p-2 rounded-xl">
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-500 block pl-2">日幣 (JPY)</label>
                        <input type="number" v-model="calcJpy" @input="convert('jpy')" class="w-full bg-transparent p-2 outline-none font-bold text-lg" placeholder="¥">
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-gray-300"></i>
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-500 block pl-2">台幣 (TWD)</label>
                        <input type="number" v-model="calcTwd" @input="convert('twd')" class="w-full bg-transparent p-2 outline-none font-bold text-lg" placeholder="$">
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 card-shadow">
                <h3 class="font-bold mb-4"><i class="fa-solid fa-plane-departure text-blue-500 mr-2"></i>航班資訊 (星宇航空)</h3>
                <div class="space-y-4">
                    <div class="border-l-4 border-blue-500 pl-3">
                        <div class="text-xs text-gray-500">去程 (2026/02/05)</div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="font-bold text-lg">TPE</span>
                            <i class="fa-solid fa-arrow-right text-gray-300"></i>
                            <span class="font-bold text-lg">FUK</span>
                        </div>
                        <div class="text-sm text-gray-600 flex justify-between mt-1">
                            <span>JX840</span>
                            <span>14:45 - 18:00</span>
                        </div>
                    </div>
                    <div class="border-l-4 border-blue-500 pl-3">
                        <div class="text-xs text-gray-500">回程 (2026/02/09)</div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="font-bold text-lg">FUK</span>
                            <i class="fa-solid fa-arrow-right text-gray-300"></i>
                            <span class="font-bold text-lg">TPE</span>
                        </div>
                        <div class="text-sm text-gray-600 flex justify-between mt-1">
                            <span>JX841</span>
                            <span>19:00 - 20:40</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 card-shadow">
                <h3 class="font-bold mb-4"><i class="fa-solid fa-bed text-ghibli-green mr-2"></i>住宿資訊</h3>
                <div v-for="(hotel, idx) in hotelInfo" :key="idx" class="mb-4 pb-4 border-b border-gray-100 last:border-0 last:pb-0 last:mb-0">
                    <div class="font-bold text-sm">{{ hotel.name }}</div>
                    <div class="flex justify-between mt-2">
                        <a :href="'tel:' + hotel.tel" class="text-xs bg-green-50 text-green-600 px-3 py-1 rounded-full"><i class="fa-solid fa-phone mr-1"></i>撥打</a>
                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + hotel.name" target="_blank" class="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded-full"><i class="fa-solid fa-location-arrow mr-1"></i>導航</a>
                    </div>
                </div>
            </div>

            <div class="bg-red-50 rounded-2xl p-5 border border-red-100">
                <h3 class="font-bold text-red-500 mb-2"><i class="fa-solid fa-kit-medical mr-2"></i>緊急聯絡</h3>
                <div class="flex justify-between text-sm">
                    <span>警察局: <span class="font-bold">110</span></span>
                    <span>救護車/火警: <span class="font-bold">119</span></span>
                </div>
                <div class="mt-2 text-xs text-gray-500">外交部旅外救助: +886-800-085-095</div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'" class="animate-fade-in">
            <h2 class="text-xl font-bold text-ghibli-dark mb-4">必買清單</h2>
            
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-2xl overflow-hidden card-shadow relative group">
                    <div class="h-32 bg-gray-100 relative">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-gray-300">
                            <i class="fa-solid fa-image text-2xl"></i>
                        </div>
                        <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-white/80 rounded-full w-6 h-6 flex items-center justify-center text-red-500 shadow-sm"><i class="fa-solid fa-xmark text-xs"></i></button>
                    </div>
                    <div class="p-3">
                        <div class="font-bold text-sm truncate">{{ item.name }}</div>
                        <div class="text-[10px] text-gray-400 mt-1">{{ item.date }} 加入</div>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-white rounded-2xl p-4 border-2 border-dashed border-gray-300">
                <input type="text" v-model="newShoppingItemName" placeholder="想買什麼？" class="w-full bg-transparent outline-none mb-3 font-bold text-ghibli-dark">
                <div class="flex items-center justify-between">
                    <label class="bg-gray-100 px-3 py-2 rounded-xl text-xs text-gray-600 cursor-pointer hover:bg-gray-200 transition">
                        <i class="fa-solid fa-camera mr-1"></i> 上傳圖片
                        <input type="file" @change="handleImageUpload" class="hidden" accept="image/*">
                    </label>
                    <button @click="addShoppingItem" class="bg-ghibli-dark text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg">新增</button>
                </div>
            </div>
             <div class="h-16"></div> <button @click="scrollToBottomShopping" class="fixed bottom-6 right-6 w-14 h-14 bg-ghibli-red text-white rounded-full shadow-2xl flex items-center justify-center text-2xl active:scale-90 transition-transform z-30 border-4 border-white">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'expenses'" class="animate-fade-in">
            <div class="bg-gradient-to-br from-ghibli-dark to-gray-700 rounded-2xl p-6 text-white shadow-xl mb-6 relative overflow-hidden">
                <div class="absolute -right-6 -top-6 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
                <div class="text-sm opacity-80 mb-1">總花費 (JPY)</div>
                <div class="text-4xl font-black">¥{{ totalExpenses.toLocaleString() }}</div>
                <div class="mt-4 flex gap-2">
                    <div class="text-xs bg-white/20 px-2 py-1 rounded">現金: {{ expensesByMethod.cash.toLocaleString() }}</div>
                    <div class="text-xs bg-white/20 px-2 py-1 rounded">信用卡: {{ expensesByMethod.card.toLocaleString() }}</div>
                </div>
            </div>

            <div class="space-y-3 pb-20">
                <div v-for="(exp, idx) in expenses" :key="idx" class="bg-white p-4 rounded-2xl card-shadow flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div :class="['w-10 h-10 rounded-full flex items-center justify-center text-white text-xs', getExpenseCategoryColor(exp.category)]">
                            <i :class="getExpenseCategoryIcon(exp.category)"></i>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-ghibli-dark">{{ exp.name }}</div>
                            <div class="text-[10px] text-gray-400">{{ exp.date }} • {{ exp.payment }}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-ghibli-dark">¥{{ parseInt(exp.amount).toLocaleString() }}</div>
                        <button @click="removeExpense(idx)" class="text-[10px] text-red-300 mt-1">刪除</button>
                    </div>
                </div>
            </div>

            <button @click="openExpenseModal" class="fixed bottom-6 right-6 w-14 h-14 bg-yellow-500 text-white rounded-full shadow-2xl flex items-center justify-center text-2xl active:scale-90 transition-transform z-30 border-4 border-white">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>
    </main>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="closeModal"></div>
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative z-10 animate-fade-in">
            <h3 class="text-lg font-bold mb-4">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
            <div class="space-y-3">
                <select v-model="form.category" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm">
                    <option value="sightseeing">景點</option>
                    <option value="stay">住宿</option>
                    <option value="food">美食</option>
                    <option value="shopping">購物</option>
                    <option value="flight">航班</option>
                    <option value="other">其他</option>
                </select>
                <input v-model="form.name" type="text" placeholder="名稱" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm">
                <div class="flex gap-2">
                    <input v-model="form.hours" type="text" placeholder="營業時間" class="w-1/2 bg-gray-50 p-3 rounded-xl outline-none text-sm">
                    <input v-model="form.price" type="text" placeholder="門票/費用" class="w-1/2 bg-gray-50 p-3 rounded-xl outline-none text-sm">
                </div>
                 <select v-model="form.transport" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm">
                    <option value="walk">步行</option>
                    <option value="car">開車</option>
                    <option value="transit">大眾運輸</option>
                </select>
                <textarea v-model="form.notes" placeholder="備註..." class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm h-20 resize-none"></textarea>
            </div>
            <div class="mt-6 flex gap-3">
                <button @click="closeModal" class="flex-1 py-3 rounded-xl text-gray-500 font-bold text-sm bg-gray-100">取消</button>
                <button @click="saveItem" class="flex-1 py-3 rounded-xl bg-ghibli-dark text-white font-bold text-sm shadow-lg">儲存</button>
            </div>
        </div>
    </div>

    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="showExpenseModal = false"></div>
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative z-10 animate-fade-in">
            <h3 class="text-lg font-bold mb-4">新增花費</h3>
            <div class="space-y-3">
                <select v-model="expenseForm.category" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm">
                    <option value="food">飲食</option>
                    <option value="transport">交通</option>
                    <option value="stay">住宿</option>
                    <option value="ticket">門票</option>
                    <option value="shopping">購物</option>
                    <option value="other">其他</option>
                </select>
                <input v-model="expenseForm.name" type="text" placeholder="項目名稱" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm">
                <input v-model="expenseForm.amount" type="number" placeholder="金額 (JPY)" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm font-bold">
                <select v-model="expenseForm.payment" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-sm">
                    <option value="現金">現金</option>
                    <option value="信用卡">信用卡</option>
                </select>
            </div>
            <div class="mt-6 flex gap-3">
                <button @click="showExpenseModal = false" class="flex-1 py-3 rounded-xl text-gray-500 font-bold text-sm bg-gray-100">取消</button>
                <button @click="saveExpense" class="flex-1 py-3 rounded-xl bg-yellow-500 text-white font-bold text-sm shadow-lg">記帳</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, reactive, onMounted, watch } = Vue;

    createApp({
        setup() {
            // Configuration
            const headerImage = './九州.png'; // Path to local image
            const currentTab = ref('itinerary');
            const selectedDayIndex = ref(0);
            
            // Tabs
            const tabs = [
                { id: 'itinerary', name: '行程', icon: 'fa-solid fa-map-location-dot' },
                { id: 'info', name: '資訊', icon: 'fa-solid fa-circle-info' },
                { id: 'shopping', name: '購物', icon: 'fa-solid fa-basket-shopping' },
                { id: 'expenses', name: '花費', icon: 'fa-solid fa-yen-sign' },
            ];

            // Days Data (Feb 2026)
            const days = [
                { date: '05', weekday: 'Thu', fullDate: '2026-02-05' },
                { date: '06', weekday: 'Fri', fullDate: '2026-02-06' },
                { date: '07', weekday: 'Sat', fullDate: '2026-02-07' },
                { date: '08', weekday: 'Sun', fullDate: '2026-02-08' },
                { date: '09', weekday: 'Mon', fullDate: '2026-02-09' },
            ];

            // Mock Data - Pre-filled from PDF
            const defaultItinerary = [
                // Day 1
                { id: 101, dayIndex: 0, category: 'flight', name: '出發: 桃園 -> 福岡', hours: '14:45', features: {flightNo: 'JX840', airline: '星宇航空', dep: '14:45', arr: '18:00'}, notes: '集合辦理出境', transport: 'walk', travelTime: '0分' },
                { id: 102, dayIndex: 0, category: 'stay', name: '福岡 ARK 飯店 (或同級)', hours: 'Check-in', notes: '自由活動', transport: 'car', travelTime: '約20分 (車)' },
                // Day 2
                { id: 201, dayIndex: 1, category: 'sightseeing', name: '豪斯登堡', hours: '09:00 - 21:00', price: '含門票', notes: '米飛兔園區、泰迪熊王國、光之王國燈光秀', transport: 'car', travelTime: '約1.5小時 (車)' },
                { id: 202, dayIndex: 1, category: 'stay', name: '豪斯登堡鹿特丹飯店 (或同級)', hours: '', notes: '享受園區夜景', transport: 'walk', travelTime: '5分 (步)' },
                // Day 3
                { id: 301, dayIndex: 2, category: 'sightseeing', name: '九十九島水族館 Kirara', hours: '10:00', price: '含門票', notes: '挖珍珠體驗 (自費)', transport: 'car', travelTime: '約20分 (車)' },
                { id: 302, dayIndex: 2, category: 'sightseeing', name: '九十九島遊覽船', hours: '50分鐘航程', notes: '珍珠皇后號或未來號', transport: 'walk', travelTime: '5分 (步)' },
                { id: 303, dayIndex: 2, category: 'food', name: '特別安排：採草莓', hours: '季節限定', price: '含體驗費', notes: '現採現吃，香甜多汁', transport: 'car', travelTime: '約30分 (車)' },
                { id: 304, dayIndex: 2, category: 'stay', name: '別府鐵輪溫泉 Spa Hotel 鶴見', hours: '', notes: '享受溫泉', transport: 'car', travelTime: '約1.5小時 (車)' },
                // Day 4
                { id: 401, dayIndex: 3, category: 'sightseeing', name: '別府海地獄', hours: '', price: '含門票', notes: '湛藍色泉水，佔地最大', transport: 'car', travelTime: '約15分 (車)' },
                { id: 402, dayIndex: 3, category: 'sightseeing', name: '湯布院 & 金鱗湖', hours: '', notes: '女性票選No.1景點，山林湖畔散策', transport: 'car', travelTime: '約40分 (車)' },
                { id: 403, dayIndex: 3, category: 'sightseeing', name: '九重森林公園滑雪場', hours: '', price: '含雪盆', notes: '雪盆體驗 (2人一個)', transport: 'car', travelTime: '約40分 (車)' },
                { id: 404, dayIndex: 3, category: 'food', name: '三大蟹吃到飽', hours: '晚餐', notes: '帝王蟹、松葉蟹等 + 軟性飲料無限暢飲', transport: 'car', travelTime: '約1.5小時 (車)' },
                 // Day 5
                { id: 501, dayIndex: 4, category: 'sightseeing', name: '太宰府天滿宮', hours: '', notes: '學問之神，飛梅傳說', transport: 'car', travelTime: '約30分 (車)' },
                { id: 502, dayIndex: 4, category: 'other', name: '旅人列車', hours: '', notes: '太宰府觀光列車體驗', transport: 'walk', travelTime: '0分' },
                { id: 503, dayIndex: 4, category: 'shopping', name: 'LaLaport 福岡', hours: '', notes: '1:1 鋼彈立像，最後衝刺', transport: 'car', travelTime: '約25分 (車)' },
                { id: 504, dayIndex: 4, category: 'flight', name: '回程: 福岡 -> 桃園', hours: '19:00', features: {flightNo: 'JX841', airline: '星宇航空', dep: '19:00', arr: '20:40'}, notes: '帶著滿滿回憶回家', transport: 'car', travelTime: '約15分 (車)' },
            ];

            const itinerary = ref(JSON.parse(localStorage.getItem('itinerary')) || defaultItinerary);
            
            // Hotel Data (Static)
            const hotelInfo = [
                { name: '福岡 ARK 飯店', tel: '+81-92-781-2555' },
                { name: '豪斯登堡鹿特丹飯店', tel: '+81-570-064-110' },
                { name: '別府鐵輪溫泉 Spa Hotel 鶴見', tel: '+81-977-66-2111' }
            ];

            // State for Modals & Forms
            const showModal = ref(false);
            const isEditing = ref(false);
            const form = reactive({ id: null, category: 'sightseeing', name: '', hours: '', price: '', notes: '', transport: 'car' });
            
            const showExpenseModal = ref(false);
            const expenseForm = reactive({ category: 'food', name: '', amount: '', payment: '現金' });
            const expenses = ref(JSON.parse(localStorage.getItem('expenses')) || []);

            const shoppingList = ref(JSON.parse(localStorage.getItem('shoppingList')) || []);
            const newShoppingItemName = ref('');
            const newShoppingItemImage = ref(null);

            // Currency
            const calcJpy = ref('');
            const calcTwd = ref('');
            const exchangeRate = 0.22; // Mock Rate (1 JPY = 0.22 TWD)

            // Weather Mock
            const currentTemp = ref(6);
            const weatherIcon = ref('fa-solid fa-snowflake');

            // --- Methods ---

            // Itinerary Methods
            const currentDayItinerary = computed(() => {
                return itinerary.value.filter(i => i.dayIndex === selectedDayIndex.value);
            });

            const getCategoryColor = (cat) => {
                const colors = {
                    sightseeing: 'bg-green-500', stay: 'bg-purple-500', food: 'bg-orange-400',
                    shopping: 'bg-pink-400', flight: 'bg-blue-600', other: 'bg-gray-400'
                };
                return colors[cat] || 'bg-gray-400';
            };

            const getCategoryLabel = (cat) => {
                 const labels = {
                    sightseeing: '景點', stay: '住宿', food: '美食',
                    shopping: '購物', flight: '航班', other: '其他'
                };
                return labels[cat];
            };

            const getCategoryIcon = (cat) => {
                const icons = {
                    sightseeing: 'fa-solid fa-camera', stay: 'fa-solid fa-bed', food: 'fa-solid fa-utensils',
                    shopping: 'fa-solid fa-bag-shopping', flight: 'fa-solid fa-plane', other: 'fa-solid fa-star'
                };
                return icons[cat];
            };
            
            const getTransportIcon = (type) => {
                 const icons = { walk: 'fa-solid fa-person-walking', car: 'fa-solid fa-car', transit: 'fa-solid fa-bus' };
                 return icons[type] || 'fa-solid fa-car';
            };

            const openAddModal = () => {
                isEditing.value = false;
                Object.assign(form, { id: Date.now(), category: 'sightseeing', name: '', hours: '', price: '', notes: '', transport: 'car' });
                showModal.value = true;
            };

            const editItem = (item) => {
                isEditing.value = true;
                Object.assign(form, JSON.parse(JSON.stringify(item))); // Deep copy
                showModal.value = true;
            };

            const saveItem = () => {
                if(!form.name) return;
                
                // Mock travel time calculation on save
                const mockTime = form.transport === 'walk' ? '10分 (步)' : form.transport === 'car' ? '30分 (車)' : '20分 (眾)';
                
                if(isEditing.value) {
                    const index = itinerary.value.findIndex(i => i.id === form.id);
                    itinerary.value[index] = { ...form, dayIndex: selectedDayIndex.value, travelTime: itinerary.value[index].travelTime }; // Keep travel time logic simple
                } else {
                    itinerary.value.push({ ...form, dayIndex: selectedDayIndex.value, travelTime: mockTime });
                }
                saveToLocal();
                closeModal();
            };

            const confirmDelete = (id) => {
                if(confirm('確定要刪除這個行程嗎？')) {
                    itinerary.value = itinerary.value.filter(i => i.id !== id);
                    saveToLocal();
                }
            };
            
            const moveItem = (index, direction) => {
                // Determine the actual index in the main array
                const currentList = currentDayItinerary.value;
                if (index + direction < 0 || index + direction >= currentList.length) return;
                
                const itemA = currentList[index];
                const itemB = currentList[index + direction];
                
                // Swap in main array logic is complex because of filter. 
                // Easier approach: recreate the array.
                // Simple swap of properties for this view (cheating a bit but works for UI)
                const realIndexA = itinerary.value.findIndex(i => i.id === itemA.id);
                const realIndexB = itinerary.value.findIndex(i => i.id === itemB.id);
                
                const temp = itinerary.value[realIndexA];
                itinerary.value[realIndexA] = itinerary.value[realIndexB];
                itinerary.value[realIndexB] = temp;
                
                saveToLocal();
            };

            const openMap = (query) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
            };

            // Currency
            const convert = (type) => {
                if(type === 'jpy') {
                    calcTwd.value = (calcJpy.value * exchangeRate).toFixed(0);
                } else {
                    calcJpy.value = (calcTwd.value / exchangeRate).toFixed(0);
                }
            };

            // Shopping
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (e) => newShoppingItemImage.value = e.target.result;
                    reader.readAsDataURL(file);
                }
            };

            const addShoppingItem = () => {
                if(!newShoppingItemName.value) return;
                shoppingList.value.push({
                    name: newShoppingItemName.value,
                    image: newShoppingItemImage.value,
                    date: new Date().toLocaleDateString()
                });
                newShoppingItemName.value = '';
                newShoppingItemImage.value = null;
                saveShopping();
            };
            
            const removeShoppingItem = (idx) => {
                shoppingList.value.splice(idx, 1);
                saveShopping();
            };
            
            const scrollToBottomShopping = () => {
                 // Logic to scroll to bottom of shopping list if needed, or just focus input
                 document.querySelector('input[placeholder="想買什麼？"]').focus();
            };

            // Expenses
            const openExpenseModal = () => {
                Object.assign(expenseForm, { category: 'food', name: '', amount: '', payment: '現金' });
                showExpenseModal.value = true;
            };

            const saveExpense = () => {
                if(!expenseForm.name || !expenseForm.amount) return;
                expenses.value.unshift({
                    ...expenseForm,
                    date: new Date().toLocaleDateString()
                });
                saveExpenses();
                showExpenseModal.value = false;
            };

            const removeExpense = (idx) => {
                if(confirm('刪除此筆花費？')) {
                    expenses.value.splice(idx, 1);
                    saveExpenses();
                }
            };

            const totalExpenses = computed(() => expenses.value.reduce((acc, curr) => acc + parseInt(curr.amount), 0));
            
            const expensesByMethod = computed(() => {
                return {
                    cash: expenses.value.filter(e => e.payment === '現金').reduce((acc, curr) => acc + parseInt(curr.amount), 0),
                    card: expenses.value.filter(e => e.payment === '信用卡').reduce((acc, curr) => acc + parseInt(curr.amount), 0)
                };
            });
            
            const getExpenseCategoryIcon = (cat) => {
                 const map = { food: 'fa-utensils', transport: 'fa-bus', stay: 'fa-bed', ticket: 'fa-ticket', shopping: 'fa-bag-shopping', other: 'fa-circle-question' };
                 return 'fa-solid ' + map[cat];
            };
            
            const getExpenseCategoryColor = (cat) => {
                const map = { food: 'bg-orange-400', transport: 'bg-blue-400', stay: 'bg-purple-400', ticket: 'bg-red-400', shopping: 'bg-pink-400', other: 'bg-gray-400' };
                return map[cat];
            };

            // Persistence
            const saveToLocal = () => localStorage.setItem('itinerary', JSON.stringify(itinerary.value));
            const saveShopping = () => localStorage.setItem('shoppingList', JSON.stringify(shoppingList.value));
            const saveExpenses = () => localStorage.setItem('expenses', JSON.stringify(expenses.value));
            const closeModal = () => showModal.value = false;

            return {
                headerImage, tabs, currentTab, days, selectedDayIndex,
                currentDayItinerary, currentTemp, weatherIcon,
                showModal, isEditing, form, openAddModal, editItem, saveItem, confirmDelete, moveItem, closeModal,
                openMap, getCategoryColor, getCategoryLabel, getCategoryIcon, getTransportIcon,
                calcJpy, calcTwd, exchangeRate, convert, hotelInfo,
                shoppingList, newShoppingItemName, handleImageUpload, addShoppingItem, removeShoppingItem, scrollToBottomShopping,
                showExpenseModal, expenseForm, expenses, openExpenseModal, saveExpense, removeExpense, totalExpenses, expensesByMethod, getExpenseCategoryIcon, getExpenseCategoryColor
            };
        }
    }).mount('#app');
</script>
</body>
</html>
