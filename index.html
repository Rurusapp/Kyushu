<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â„ï¸ ä¹å·å¤¢å¹»ä¹‹æ—… | My Travel App</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // æ ¹æ“šæ‚¨æä¾›çš„åœ–ç‰‡èƒŒæ™¯è‰²ï¼ˆé›ªåœ°ã€å¤©ç©ºæ·¡è—ã€æ«»èŠ±ç²‰ï¼‰èª¿æ•´çš„ä¸»è‰²èª¿
                        'primary-sky': '#B3E5FC', // æ·¡é›…çš„å¤©ç©ºè—ï¼Œä½œç‚ºèƒŒæ™¯å»¶ä¼¸
                        'accent-sakura': '#F8BBD0', // æ«»èŠ±ç²‰ï¼Œç”¨æ–¼å¼·èª¿
                        'deep-mountain': '#4A5568', // å±±è„ˆç°ï¼Œç”¨æ–¼æ–‡å­—æˆ–æ·±åº¦
                        'snow-white': '#F7FAFC', // é›ªç™½ï¼Œä¸»è¦å…§å®¹å€èƒŒæ™¯
                    },
                    backgroundImage: {
                        // é€™æ˜¯æ‚¨æä¾›çš„åœ–ç‰‡çš„ URLï¼ˆè«‹å°‡æ­¤æ›¿æ›ç‚ºæ‚¨åœ–ç‰‡çš„å¯¦éš›è¨—ç®¡ URLï¼‰
                        'hero-banner': 'url("https://i.imgur.com/your-hosted-image-url.jpg")', // **è«‹æ›¿æ›ç‚ºæ‚¨çš„åœ–ç‰‡ URL**
                    }
                }
            }
        }
    </script>
    <style>
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ (åƒ…é©ç”¨æ–¼ Webkit ç€è¦½å™¨) */
        .custom-scrollbar::-webkit-scrollbar {
            height: 4px; /* èª¿æ•´æ©«å‘æ»¾å‹•æ¢çš„é«˜åº¦ */
            width: 4px; /* èª¿æ•´ç¸±å‘æ»¾å‹•æ¢çš„å¯¬åº¦ */
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #B3E5FC; /* æ»¾å‹•æ¢é¡è‰² */
            border-radius: 2px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #F7FAFC;
        }

        /* ç¢ºä¿åº•éƒ¨ Tab Bar æµ®å‹•åœ¨æœ€ä¸Šå±¤ */
        .tab-bar {
            z-index: 50;
        }
        
        /* åœ“å¼§éŠœæ¥æ•ˆæœçš„ CSS */
        .banner-mask {
            /* èª¿æ•´é€™å€‹å€¼ä¾†æ”¹è®Šåœ“å¼§çš„é«˜åº¦ */
            height: 100px; 
            background-color: #F7FAFC; /* å…§å®¹å€çš„èƒŒæ™¯è‰² */
            border-top-left-radius: 100%;
            border-top-right-radius: 100%;
            transform: translateY(-50px); /* å‘ä¸Šæ‹‰å‹•èˆ‡åœ–ç‰‡é‡ç–Šï¼Œå‰µé€ åœ“æ½¤æ•ˆæœ */
            z-index: 10;
            position: relative;
        }
    </style>
</head>
<body class="bg-primary-sky min-h-screen">
    <div id="app" class="max-w-md mx-auto shadow-2xl bg-snow-white">
        <div class="h-40 bg-cover bg-center" style="background-image: url('Gemini_Generated_Image_o3s3oto3s3oto3s3.jpg');">
            </div>

        <div class="banner-mask relative"></div>

        <div class="tab-bar sticky top-0 bg-transparent -mt-20 flex justify-end px-4 space-x-2">
            <template v-for="tab in tabs" :key="tab.id">
                <button 
                    @click="activeTab = tab.id"
                    :class="{'bg-accent-sakura text-white shadow-xl': activeTab === tab.id, 'bg-snow-white text-deep-mountain hover:bg-gray-100': activeTab !== tab.id}"
                    class="p-3 rounded-full transition duration-300 transform hover:scale-105"
                    :title="tab.name"
                >
                    <span class="material-icons">{{ tab.icon }}</span>
                </button>
            </template>
        </div>

        <main class="p-4 bg-snow-white -mt-10 pt-6 min-h-[calc(100vh-250px)] relative z-20">
            <h1 class="text-2xl font-bold text-deep-mountain mb-4">{{ tabs.find(t => t.id === activeTab).name }}</h1>

            <section v-show="activeTab === 'schedule'">
                <div class="flex overflow-x-auto space-x-3 pb-3 custom-scrollbar">
                    <template v-for="(day, index) in itinerary" :key="index">
                        <button 
                            @click="activeDay = index"
                            :class="{'bg-accent-sakura text-white shadow-lg': activeDay === index, 'bg-gray-100 text-deep-mountain hover:bg-gray-200': activeDay !== index}"
                            class="flex-shrink-0 p-3 rounded-xl transition duration-300 w-20 text-center"
                        >
                            <div class="text-lg font-semibold">{{ day.dayOfWeek }}</div>
                            <div class="text-xl font-bold mt-1">{{ day.date }}</div>
                            <div class="text-xs">Day {{ index + 1 }}</div>
                        </button>
                    </template>
                </div>

                <div class="flex items-center space-x-3 p-3 bg-primary-sky/30 rounded-lg mt-4 mb-4 text-deep-mountain shadow-sm">
                    <span class="material-icons text-3xl text-yellow-500">wb_sunny</span>
                    <div>
                        <div class="font-semibold">ç•¶åœ°å¤©æ°£ (Day {{ activeDay + 1 }})</div>
                        <div class="text-2xl font-bold">5Â°C / é«”æ„Ÿ -1Â°C</div>
                    </div>
                </div>

                <select v-model="filterCategory" class="w-full p-2 border border-gray-300 rounded-lg mb-4 bg-white text-deep-mountain">
                    <option value="">å…¨éƒ¨é¡åˆ¥</option>
                    <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                </select>

                <div class="space-y-4">
                    <template v-for="(item, index) in filteredSchedule" :key="item.id">
                        <div v-if="index > 0" class="flex items-center justify-center text-sm text-gray-500 my-2">
                            <span class="material-icons text-base mr-1">{{ item.transportIcon }}</span>
                            {{ item.travelTime }}
                        </div>
                        
                        <div v-if="index === 0 && activeDay === 0" class="bg-blue-100 p-4 rounded-xl shadow-md border-l-4 border-blue-500">
                            <h3 class="font-bold text-lg text-blue-700">âœˆï¸ {{ item.name }}</h3>
                            <div class="grid grid-cols-2 gap-2 text-sm mt-2">
                                <div><span class="font-semibold">èˆªç­:</span> {{ flightInfo.outbound.flightNumber }}</div>
                                <div><span class="font-semibold">é£›è¡Œæ™‚é–“:</span> {{ item.travelTime }}</div>
                                <div><span class="font-semibold">èµ·é£›:</span> {{ flightInfo.outbound.departureAirport }} {{ flightInfo.outbound.departureTime }}</div>
                                <div><span class="font-semibold">æŠµé”:</span> {{ flightInfo.outbound.arrivalAirport }} {{ flightInfo.outbound.arrivalTime }}</div>
                            </div>
                        </div>

                        <div v-else 
                            @click="showEditModal(activeDay, index)"
                            :class="{'border-l-4 border-accent-sakura': item.category === 'æ™¯é»', 'border-l-4 border-yellow-500': item.category === 'ç¾é£Ÿ'}"
                            class="bg-white p-4 rounded-xl shadow-md cursor-pointer hover:shadow-lg transition duration-200"
                        >
                            <div class="flex items-start justify-between">
                                <h3 class="font-bold text-lg text-deep-mountain">
                                    <span class="material-icons align-middle text-accent-sakura mr-1">{{ item.icon }}</span>
                                    {{ item.name }}
                                </h3>
                                <span class="text-sm bg-gray-200 px-2 py-0.5 rounded-full">{{ item.category }}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">
                                <span v-if="item.openingHours"><span class="font-semibold">æ™‚é–“:</span> {{ item.openingHours }}</span>
                                <span v-if="item.ticket"><span class="font-semibold block">é–€ç¥¨:</span> {{ item.ticket }}</span>
                            </p>
                            <p class="text-sm italic text-gray-400 mt-2 line-clamp-2">{{ item.notes }}</p>
                        </div>
                    </template>
                </div>

                <button @click="showAddModal(activeDay)" class="fixed bottom-6 right-6 p-4 rounded-full bg-accent-sakura text-white shadow-xl hover:bg-pink-600 transition duration-300">
                    <span class="material-icons text-3xl">add</span>
                </button>
            </section>

            <section v-show="activeTab === 'info'" class="space-y-6">
                <div class="bg-white p-4 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold text-deep-mountain border-b pb-2 mb-3">ğŸ’° åŒ¯ç‡æ›ç®— (JPY â†’ TWD)</h2>
                    <p class="text-xs text-gray-500 mb-2">ä½¿ç”¨æ¨¡æ“¬åŒ¯ç‡: 1 JPY = {{ exchangeRate.twd }} TWD</p>
                    <div class="flex items-center space-x-3">
                        <input type="number" v-model.number="jpyAmount" placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡ (JPY)" class="flex-grow p-2 border rounded-lg focus:ring-accent-sakura focus:border-accent-sakura">
                        <span class="text-2xl font-bold text-deep-mountain">=</span>
                        <div class="w-1/3 text-right text-xl font-bold text-accent-sakura">{{ convertedTWD.toFixed(2) }} TWD</div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold text-deep-mountain border-b pb-2 mb-3">âœˆï¸ èˆªç­è³‡è¨Š</h2>
                    <h3 class="font-bold text-lg mt-3 text-deep-mountain">å»ç¨‹ (Outbound)</h3>
                    <div class="bg-blue-50 p-3 rounded-lg text-sm grid grid-cols-2 gap-2">
                        <div><span class="font-semibold">èˆªç­ç·¨è™Ÿ:</span> {{ flightInfo.outbound.flightNumber }}</div>
                        <div><span class="font-semibold">èµ·é£›æ™‚é–“:</span> {{ flightInfo.outbound.departureTime }}</div>
                        <div><span class="font-semibold">å‡ºç™¼åœ°:</span> {{ flightInfo.outbound.departureAirport }}</div>
                        <div><span class="font-semibold">æŠµé”æ™‚é–“:</span> {{ flightInfo.outbound.arrivalTime }}</div>
                        <div class="col-span-2"><span class="font-semibold">ç›®çš„åœ°:</span> {{ flightInfo.outbound.arrivalAirport }}</div>
                    </div>

                    <h3 class="font-bold text-lg mt-4 text-deep-mountain">å›ç¨‹ (Return)</h3>
                    <div class="bg-blue-50 p-3 rounded-lg text-sm grid grid-cols-2 gap-2">
                        <div><span class="font-semibold">èˆªç­ç·¨è™Ÿ:</span> {{ flightInfo.return.flightNumber }}</div>
                        <div><span class="font-semibold">èµ·é£›æ™‚é–“:</span> {{ flightInfo.return.departureTime }}</div>
                        <div><span class="font-semibold">å‡ºç™¼åœ°:</span> {{ flightInfo.return.departureAirport }}</div>
                        <div><span class="font-semibold">æŠµé”æ™‚é–“:</span> {{ flightInfo.return.arrivalTime }}</div>
                        <div class="col-span-2"><span class="font-semibold">ç›®çš„åœ°:</span> {{ flightInfo.return.arrivalAirport }}</div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold text-deep-mountain border-b pb-2 mb-3">ğŸ¨ ä½å®¿è³‡è¨Š</h2>
                    <template v-for="hotel in accommodationInfo" :key="hotel.name">
                        <div class="mb-4 p-3 border-b last:border-b-0">
                            <h3 class="font-bold text-lg text-deep-mountain">{{ hotel.name }}</h3>
                            <p class="text-sm text-gray-600"><span class="font-semibold">é›»è©±:</span> {{ hotel.phone }}</p>
                            <p class="text-sm text-gray-600"><span class="font-semibold">åœ°å€:</span> {{ hotel.address }}</p>
                            <a :href="hotel.mapLink" target="_blank" class="text-accent-sakura text-sm font-semibold mt-1 inline-flex items-center hover:underline">
                                Google Map å°èˆª <span class="material-icons text-base ml-1">chevron_right</span>
                            </a>
                        </div>
                    </template>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold text-deep-mountain border-b pb-2 mb-3">ğŸš— ç§Ÿè»Šè³‡è¨Š</h2>
                    <p class="text-sm text-gray-600 mb-2">é ç´„å…¬å¸: è±ç”°ç§Ÿè»Š (Toyota Rent-a-Car)</p>
                    <p class="text-sm text-gray-600 mb-2">å–è»Šåœ°å€: ç¦å²¡æ©Ÿå ´åº—</p>
                    <p class="text-sm text-gray-600 mb-2">é ç´„è™Ÿç¢¼: TBC123456</p>
                    <a href="https://maps.app.goo.gl/FUKUOKA_RENTAL_ADDRESS" target="_blank" class="text-accent-sakura text-sm font-semibold mt-1 inline-flex items-center hover:underline">
                        å°èˆªè‡³ç§Ÿè»Šè™• <span class="material-icons text-base ml-1">chevron_right</span>
                    </a>
                </div>

                <div class="bg-red-50 p-4 rounded-xl shadow-md border-l-4 border-red-500">
                    <h2 class="text-xl font-bold text-red-700 border-b border-red-200 pb-2 mb-3">ğŸš¨ ç·Šæ€¥è¯çµ¡</h2>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <p class="font-bold text-lg text-red-700">è­¦å¯Ÿ (Police)</p>
                            <a href="tel:110" class="text-2xl font-extrabold text-red-500 block hover:underline">110</a>
                        </div>
                        <div>
                            <p class="font-bold text-lg text-red-700">æ•‘è­·è»Š/ç«è­¦ (Ambulance/Fire)</p>
                            <a href="tel:119" class="text-2xl font-extrabold text-red-500 block hover:underline">119</a>
                        </div>
                    </div>
                </div>
            </section>

            <section v-show="activeTab === 'shopping'">
                <div class="space-y-4">
                    <div v-for="(item, index) in shoppingList" :key="index" class="bg-white p-4 rounded-xl shadow-md flex items-center space-x-4">
                        <input type="checkbox" v-model="item.purchased" class="h-6 w-6 text-accent-sakura rounded focus:ring-accent-sakura border-gray-300">
                        <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden">
                            <span v-if="!item.image" class="material-icons text-3xl text-gray-400">camera_alt</span>
                            <img v-else :src="item.image" :alt="item.name" class="object-cover w-full h-full">
                        </div>
                        <div :class="{'line-through text-gray-500': item.purchased}" class="flex-grow">
                            <h3 class="font-bold text-lg text-deep-mountain">{{ item.name }}</h3>
                            <p class="text-sm text-gray-600 italic">{{ item.notes }}</p>
                        </div>
                        <button @click="removeShoppingItem(index)" class="text-red-400 hover:text-red-600 transition">
                            <span class="material-icons text-xl">delete</span>
                        </button>
                    </div>
                </div>
                <button @click="showShoppingModal = true" class="fixed bottom-6 right-6 p-4 rounded-full bg-accent-sakura text-white shadow-xl hover:bg-pink-600 transition duration-300">
                    <span class="material-icons text-3xl">add</span>
                </button>
            </section>

            <section v-show="activeTab === 'expenses'">
                <div class="p-4 bg-primary-sky/30 rounded-xl shadow-md mb-4 text-center">
                    <div class="text-sm font-semibold text-deep-mountain">ç¸½èŠ±è²» (TWD ä¼°è¨ˆ)</div>
                    <div class="text-3xl font-extrabold text-accent-sakura">NT$ {{ totalExpenseTWD.toLocaleString() }}</div>
                    <div class="text-lg font-semibold text-deep-mountain">ç¸½èŠ±è²» (JPY)</div>
                    <div class="text-2xl font-bold text-deep-mountain">Â¥ {{ totalExpenseJPY.toLocaleString() }}</div>
                </div>

                <div class="space-y-3">
                    <div v-for="(expense, index) in expensesList" :key="index" class="bg-white p-4 rounded-xl shadow-md border-l-4" :class="getCategoryBorder(expense.category)">
                        <div class="flex justify-between items-start">
                            <div class="flex-grow">
                                <span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-gray-200">{{ expense.category }}</span>
                                <h3 class="font-bold text-lg mt-1 text-deep-mountain">{{ expense.name }}</h3>
                                <p class="text-sm text-gray-600">{{ expense.date }} â€¢ {{ expense.paymentMethod }}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-xl font-bold text-deep-mountain">Â¥ {{ expense.amount.toLocaleString() }}</div>
                                <div class="text-sm text-gray-500">~NT$ {{ (expense.amount * exchangeRate.twd).toFixed(0) }}</div>
                            </div>
                        </div>
                        <p v-if="expense.notes" class="text-sm italic text-gray-400 mt-2">å‚™è¨»: {{ expense.notes }}</p>
                    </div>
                </div>

                <button @click="showExpenseModal = true" class="fixed bottom-6 right-6 p-4 rounded-full bg-accent-sakura text-white shadow-xl hover:bg-pink-600 transition duration-300">
                    <span class="material-icons text-3xl">add</span>
                </button>
            </section>
        </main>

        <div v-if="showScheduleModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl w-full max-w-md shadow-2xl">
                <h2 class="text-2xl font-bold mb-4 text-deep-mountain">{{ currentEditItem ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h2>
                <form @submit.prevent="saveScheduleItem" class="space-y-3">
                    <input type="text" v-model="form.name" placeholder="è¡Œç¨‹åç¨±*" required class="w-full p-3 border rounded-lg">
                    <select v-model="form.category" required class="w-full p-3 border rounded-lg">
                        <option value="" disabled>é¸æ“‡åˆ†é¡*</option>
                        <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                    </select>

                    <input v-if="['æ™¯é»', 'ä½å®¿', 'ç¾é£Ÿ', 'è³¼ç‰©'].includes(form.category)" 
                           type="text" v-model="form.openingHours" placeholder="ç‡Ÿæ¥­æ™‚é–“ (e.g. 10:00-18:00)" class="w-full p-3 border rounded-lg">
                    
                    <input v-if="form.category === 'æ™¯é»'" 
                           type="text" v-model="form.ticket" placeholder="é–€ç¥¨è³‡è¨Š (e.g. Â¥2,000)" class="w-full p-3 border rounded-lg">
                    
                    <textarea v-model="form.notes" placeholder="ç‰¹è‰² & å‚™è¨»" rows="3" class="w-full p-3 border rounded-lg"></textarea>
                    
                    <div class="flex justify-between pt-4">
                        <button type="button" @click="showScheduleModal = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                        <div class="flex space-x-3">
                            <button v-if="currentEditItem" type="button" @click="confirmDelete" class="flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                <span class="material-icons text-xl mr-1">delete</span> åˆªé™¤
                            </button>
                            <button type="submit" class="px-6 py-2 bg-accent-sakura text-white rounded-lg hover:bg-pink-600 transition">å„²å­˜</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div v-if="showShoppingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl w-full max-w-md shadow-2xl">
                <h2 class="text-2xl font-bold mb-4 text-deep-mountain">ğŸ›ï¸ æ–°å¢è³¼ç‰©é …ç›®</h2>
                <form @submit.prevent="addShoppingItem" class="space-y-3">
                    <input type="text" v-model="newShoppingItem.name" placeholder="å•†å“åç¨±*" required class="w-full p-3 border rounded-lg">
                    <input type="file" @change="handleImageUpload" accept="image/*" class="w-full p-3 border rounded-lg">
                    <input type="text" v-model="newShoppingItem.notes" placeholder="å‚™è¨» (e.g. å“ªè£¡è²·ã€åƒ¹æ ¼ä¼°è¨ˆ)" class="w-full p-3 border rounded-lg">
                    
                    <div class="flex justify-end pt-4 space-x-3">
                        <button type="button" @click="showShoppingModal = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                        <button type="submit" class="px-6 py-2 bg-accent-sakura text-white rounded-lg hover:bg-pink-600 transition">æ–°å¢</button>
                    </div>
                </form>
            </div>
        </div>

        <div v-if="showExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl w-full max-w-md shadow-2xl">
                <h2 class="text-2xl font-bold mb-4 text-deep-mountain">ğŸ’´ è¨˜éŒ„èŠ±è²»</h2>
                <form @submit.prevent="addExpenseItem" class="space-y-3">
                    <input type="text" v-model="newExpenseItem.name" placeholder="åç¨± (e.g. ä¸€è˜­æ‹‰éºµ)" required class="w-full p-3 border rounded-lg">
                    <select v-model="newExpenseItem.category" required class="w-full p-3 border rounded-lg">
                        <option value="" disabled>é¸æ“‡é¡åˆ¥*</option>
                        <option v-for="cat in expenseCategories" :key="cat" :value="cat">{{ cat }}</option>
                    </select>
                    
                    <input type="date" v-model="newExpenseItem.date" required class="w-full p-3 border rounded-lg">

                    <input type="number" v-model.number="newExpenseItem.amount" placeholder="é‡‘é¡ (æ—¥å¹£ Â¥)*" required class="w-full p-3 border rounded-lg">

                    <select v-model="newExpenseItem.paymentMethod" required class="w-full p-3 border rounded-lg">
                        <option value="" disabled>ä»˜æ¬¾æ–¹å¼*</option>
                        <option value="ç¾é‡‘">ç¾é‡‘</option>
                        <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                    </select>
                    
                    <textarea v-model="newExpenseItem.notes" placeholder="å‚™è¨»" rows="2" class="w-full p-3 border rounded-lg"></textarea>
                    
                    <div class="flex justify-end pt-4 space-x-3">
                        <button type="button" @click="showExpenseModal = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                        <button type="submit" class="px-6 py-2 bg-accent-sakura text-white rounded-lg hover:bg-pink-600 transition">è¨˜éŒ„</button>
                    </div>
                </form>
            </div>
        </div>

        <div v-if="showDeleteConfirm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl w-full max-w-sm shadow-2xl text-center">
                <span class="material-icons text-4xl text-red-500 mb-3">warning</span>
                <h2 class="text-xl font-bold mb-2 text-deep-mountain">ç¢ºèªåˆªé™¤è¡Œç¨‹?</h2>
                <p class="text-sm text-gray-600">æ­¤å‹•ä½œä¸å¯é€†è½‰ï¼Œæ‚¨ç¢ºå®šè¦åˆªé™¤ã€Œ{{ currentEditItem.name }}ã€å—ï¼Ÿ</p>
                <div class="flex justify-center space-x-4 mt-5">
                    <button @click="showDeleteConfirm = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                    <button @click="deleteScheduleItem" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">ç¢ºå®šåˆªé™¤</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, reactive, watch } = Vue

        const app = createApp({
            setup() {
                // --- æ•¸æ“šçµæ§‹ ---
                const activeTab = ref('schedule')
                const activeDay = ref(0)
                const filterCategory = ref('')
                const showScheduleModal = ref(false)
                const showShoppingModal = ref(false)
                const showExpenseModal = ref(false)
                const showDeleteConfirm = ref(false)
                const currentEditItem = ref(null)
                const currentEditDayIndex = ref(null)
                const currentEditItemIndex = ref(null)
                
                const form = reactive({
                    name: '',
                    category: '',
                    openingHours: '',
                    ticket: '',
                    notes: '',
                })

                const tabs = [
                    { id: 'schedule', name: 'æ¯æ—¥è¡Œç¨‹è¡¨', icon: 'map' },
                    { id: 'info', name: 'è³‡è¨Š', icon: 'info' },
                    { id: 'shopping', name: 'è³¼ç‰©æ¸…å–®', icon: 'shopping_basket' },
                    { id: 'expenses', name: 'èŠ±è²»', icon: 'payments' },
                ]

                const categories = ['æ™¯é»', 'ä½å®¿', 'ç¾é£Ÿ', 'è³¼ç‰©', 'èˆªç­', 'å…¶ä»–']
                const expenseCategories = ['äº¤é€š', 'é£²é£Ÿ', 'ä½å®¿', 'é–€ç¥¨', 'è³¼ç‰©', 'å…¶ä»–']
                
                const exchangeRate = { twd: 0.215 } // æ¨¡æ“¬åŒ¯ç‡: 1 JPY = 0.215 TWD
                const jpyAmount = ref(0)

                // æ¨¡æ“¬æ•¸æ“š: è¡Œç¨‹è³‡è¨Š (ä½¿ç”¨æ‚¨æä¾›çš„ PDF æ•¸æ“š)
                const itinerary = reactive([
                    // Day 1: å°åŒ— â†’ ç¦å²¡
                    { dayOfWeek: 'Thu', date: '5', items: [
                        { id: 101, name: 'å°åŒ—æ¡ƒåœ’ â†’ ç¦å²¡æ©Ÿå ´ (JX840)', category: 'èˆªç­', icon: 'flight', travelTime: '14:45 - 18:00 (é£›è¡Œæ™‚é–“: 2h 15m)', transportIcon: 'flight', isFlight: true },
                        // *å‡è¨­* å¾æ©Ÿå ´åˆ°é£¯åº—çš„äº¤é€šæ™‚é–“
                        { id: 102, name: 'ç¦å²¡ ARK é£¯åº—æˆ–åŒç´š (ä½å®¿)', category: 'ä½å®¿', icon: 'hotel', openingHours: 'Check-in 15:00', notes: 'ä½å®¿ï¼šç¦å²¡ ARK é£¯åº—/ç¦å²¡ä¸­æ´²å·ç«¯æ±æ–¹å¿«æ·é£¯åº—ç­‰', travelTime: '45m', transportIcon: 'directions_car' }, 
                    ]},
                    // Day 2: è±ªæ–¯ç™»å ¡
                    { dayOfWeek: 'Fri', date: '6', items: [
                        { id: 201, name: 'é£¯åº—æ—©é¤', category: 'ç¾é£Ÿ', icon: 'restaurant', openingHours: '07:00-09:00', notes: 'é£¯åº—å…§æ—©é¤', travelTime: '0m', transportIcon: 'directions_walk' },
                        { id: 202, name: 'ä¹å·è±ªæ–¯ç™»å ¡ (ä¸»é¡Œæ¨‚åœ’)', category: 'æ™¯é»', icon: 'park', openingHours: '09:00-21:00', ticket: 'å·²å«é–€ç¥¨', notes: 'ç±³é£›åœ’å€ã€å¤¢å¹»ç‡ˆå…‰ç§€ã€è·è˜­é€ æ™¯ã€‚åˆæ™šé¤è«‹è‡ªç†ã€‚', travelTime: '1h 30m', transportIcon: 'directions_car' },
                        { id: 203, name: 'è±ªæ–¯ç™»å ¡é¹¿ç‰¹ä¸¹é£¯åº—æˆ–åŒç´š (ä½å®¿)', category: 'ä½å®¿', icon: 'hotel', openingHours: 'Check-in 15:00', notes: 'ä½å®¿ï¼šè±ªæ–¯ç™»å ¡é¹¿ç‰¹ä¸¹é£¯åº—/æµ·ç‰™é£¯åº—/JRè±ªæ–¯ç™»å ¡å¤§å€‰é£¯åº—ç­‰', travelTime: '10m', transportIcon: 'directions_walk' },
                    ]},
                    // Day 3: ä¹åä¹å³¶ & æ¡è‰è“
                    { dayOfWeek: 'Sat', date: '7', items: [
                        { id: 301, name: 'é£¯åº—æ—©é¤', category: 'ç¾é£Ÿ', icon: 'restaurant', openingHours: '07:00-09:00', notes: 'é£¯åº—å…§æ—©é¤', travelTime: '0m', transportIcon: 'directions_walk' },
                        { id: 302, name: 'ä¹åä¹å³¶æ°´æ—é¤¨ kirara', category: 'æ™¯é»', icon: 'aquarium', openingHours: '09:00-17:00', ticket: 'å·²å«é–€ç¥¨', notes: 'å¯è‡ªè²»æŒ–çç ã€‚', travelTime: '30m', transportIcon: 'directions_car' },
                        { id: 303, name: 'ä¹åä¹å³¶éŠè¦½èˆ¹', category: 'æ™¯é»', icon: 'directions_boat', openingHours: 'ä¾èˆªç­æ™‚é–“', ticket: 'å·²å«èˆ¹ç¥¨', notes: 'æ­ä¹˜çç çš‡åè™Ÿæˆ–æœªä¾†è™Ÿï¼ŒéŠè¦½è¥¿æµ·åœ‹ç«‹å…¬åœ’ã€‚', travelTime: '5m', transportIcon: 'directions_walk' },
                        { id: 304, name: 'ç•¶åœ°é¢¨å‘³å¾¡è†³ (åˆé¤)', category: 'ç¾é£Ÿ', icon: 'lunch_dining', openingHours: '12:30-13:30', notes: 'é¤æ¨™2200æ—¥å¹£', travelTime: '15m', transportIcon: 'directions_car' },
                        { id: 305, name: 'å­£ç¯€é™å®šæ¡è‰è“é«”é©—', category: 'æ™¯é»', icon: 'local_florist', openingHours: '14:30-15:30', ticket: 'å·²å«é«”é©—è²»', notes: 'ç¾æ¡ç¾åƒï¼Œå¦‚é‡å®¢æ»¿æ”¹è´ˆæ°´æœä¸¦é€€Â¥1500ã€‚', travelTime: '45m', transportIcon: 'directions_car' },
                        { id: 306, name: 'åˆ¥åºœéµè¼ªæº«æ³‰ Spa Hotel é¶´è¦‹æˆ–åŒç´š (ä½å®¿)', category: 'ä½å®¿', icon: 'hotel', openingHours: 'Check-in 15:00', notes: 'é£¯åº—å…§æœƒå¸­æ–™ç†æˆ–è‡ªåŠ©é¤ (æ™šé¤)', travelTime: '2h 0m', transportIcon: 'directions_car' },
                    ]},
                    // Day 4: åˆ¥åºœåœ°ç„, æ¹¯å¸ƒé™¢, æ»‘é›ª
                    { dayOfWeek: 'Sun', date: '8', items: [
                        { id: 401, name: 'é£¯åº—æ—©é¤', category: 'ç¾é£Ÿ', icon: 'restaurant', openingHours: '07:00-09:00', notes: 'é£¯åº—å…§æ—©é¤', travelTime: '0m', transportIcon: 'directions_walk' },
                        { id: 402, name: 'åˆ¥åºœæµ·åœ°ç„', category: 'æ™¯é»', icon: 'filter_drama', openingHours: '08:00-17:00', ticket: 'å·²å«é–€ç¥¨', notes: 'å¦‚é‡å®šä¼‘æ”¹èµ°æ˜ç¤¬åœ°ç„ã€‚', travelTime: '15m', transportIcon: 'directions_car' },
                        { id: 403, name: 'æ¹¯å¸ƒé™¢ç²¾ç¾æ–™ç† (åˆé¤)', category: 'ç¾é£Ÿ', icon: 'lunch_dining', openingHours: '12:00-13:00', notes: 'é¤æ¨™2200æ—¥å¹£', travelTime: '45m', transportIcon: 'directions_car' },
                        { id: 404, name: 'æ¹¯å¸ƒé™¢ãƒ»é‡‘é±—æ¹–æ•£ç­–', category: 'æ™¯é»', icon: 'landscape', openingHours: 'å…¨å¤©é–‹æ”¾', ticket: 'å…è²»', notes: 'æ•£æ­¥å±±æ—æ¹–ç•”å°å¾‘ï¼Œæ¬£è³æ™¨éœ§ç¾æ™¯ã€‚', travelTime: '5m', transportIcon: 'directions_walk' },
                        { id: 405, name: 'ä¹é‡æ£®æ—å…¬åœ’æ»‘é›ªå ´ (é›ªç›†é«”é©—)', category: 'æ™¯é»', icon: 'ac_unit', openingHours: '09:00-17:00', ticket: 'å·²å«é›ªç›†è²»', notes: 'ä¹å·æœ€å¤§æ»‘é›ªå ´ï¼Œæä¾›é›ªç›†2äººä¸€å€‹ã€‚è‹¥é›ªé‡ä¸è¶³é€€Â¥1500ã€‚', travelTime: '1h 0m', transportIcon: 'directions_car' },
                        { id: 406, name: 'ä¸‰å¤§èŸ¹åƒåˆ°é£½ (æ™šé¤)', category: 'ç¾é£Ÿ', icon: 'dinner_dining', openingHours: '18:30-19:40', notes: 'ä¸‰å¤§èŸ¹+è»Ÿæ€§é£²æ–™ç„¡é™æš¢é£² (é¤æ¨™Â¥6600)ã€‚è‹¥ç¼ºè²¨æ”¹æ¶®æ¶®é‹åƒåˆ°é£½ä¸¦é€€Â¥3000ã€‚', travelTime: '2h 0m', transportIcon: 'directions_car' },
                        { id: 407, name: 'ç¦å²¡ ARK é£¯åº—æˆ–åŒç´š (ä½å®¿)', category: 'ä½å®¿', icon: 'hotel', openingHours: 'Check-in 15:00', notes: 'ä½å®¿ï¼šç¦å²¡ ARK é£¯åº—/ç¦å²¡ä¸­æ´²å·ç«¯æ±æ–¹å¿«æ·é£¯åº—ç­‰', travelTime: '10m', transportIcon: 'directions_walk' },
                    ]},
                    // Day 5: å¤ªå®°åºœ & LaLaport â†’ å°åŒ—
                    { dayOfWeek: 'Mon', date: '9', items: [
                        { id: 501, name: 'é£¯åº—æ—©é¤', category: 'ç¾é£Ÿ', icon: 'restaurant', openingHours: '07:00-09:00', notes: 'é£¯åº—å…§æ—©é¤', travelTime: '0m', transportIcon: 'directions_walk' },
                        { id: 502, name: 'å¤ªå®°åºœæ—…äººåˆ—è»Š', category: 'äº¤é€š', icon: 'train', openingHours: 'ä¾ç­æ¬¡', ticket: 'å·²å«è»Šç¥¨', notes: 'å¦‚é‡åœé§›é€€Â¥170/äººã€‚', travelTime: '30m', transportIcon: 'directions_bus' },
                        { id: 503, name: 'å¤ªå®°åºœå¤©æ»¿å®®', category: 'æ™¯é»', icon: 'temple_buddhist', openingHours: 'å…¨å¤©é–‹æ”¾', ticket: 'å…è²»', notes: 'å­¸å•ä¹‹ç¥ï¼Œå¯è²·æ¢…é¤…ã€‚', travelTime: '5m', transportIcon: 'directions_walk' },
                        { id: 504, name: 'å…ç¨…åº—', category: 'è³¼ç‰©', icon: 'store', openingHours: '10:00-18:00', notes: 'ç¦®å“é¸è³¼ã€‚', travelTime: '20m', transportIcon: 'directions_car' },
                        { id: 505, name: 'LaLaport ç¦å²¡', category: 'è³¼ç‰©', icon: 'shopping_bag', openingHours: '10:00-21:00', notes: 'åˆé¤è«‹è‡ªç†ã€‚ä¹å·é¦–æ¬¡çš„ LaLaportï¼Œç´„220åº—é‹ªã€‚', travelTime: '25m', transportIcon: 'directions_car' },
                        { id: 506, name: 'ç¦å²¡æ©Ÿå ´ â†’ å°åŒ—æ¡ƒåœ’ (JX841)', category: 'èˆªç­', icon: 'flight', travelTime: '19:00 - 20:40 (é£›è¡Œæ™‚é–“: 1h 40m)', transportIcon: 'flight', isFlight: true },
                    ]},
                ])

                // æ¨¡æ“¬æ•¸æ“š: èˆªç­è³‡è¨Š
                const flightInfo = {
                    [cite_start]outbound: { airline: 'æ˜Ÿå®‡èˆªç©º', flightNumber: 'JX840', departureAirport: 'æ¡ƒåœ’TPE', arrivalAirport: 'ç¦å²¡FUK', departureTime: '14:45', arrivalTime: '18:00', duration: '2h 15m' }, // [cite: 5]
                    [cite_start]return: { airline: 'æ˜Ÿå®‡èˆªç©º', flightNumber: 'JX841', departureAirport: 'ç¦å²¡FUK', arrivalAirport: 'æ¡ƒåœ’TPE', departureTime: '19:00', arrivalTime: '20:40', duration: '1h 40m' }, // [cite: 5]
                }
                
                // æ¨¡æ“¬æ•¸æ“š: ä½å®¿è³‡è¨Š
                const accommodationInfo = [
                    [cite_start]{ name: 'ç¦å²¡ ARK é£¯åº—', phone: '+81-92-123-4567', address: 'ç¦å²¡å¸‚åšå¤šå€A B C', mapLink: 'https://maps.app.goo.gl/FUKUOKA_ARK_HOTEL' }, // [cite: 54]
                    [cite_start]{ name: 'è±ªæ–¯ç™»å ¡é¹¿ç‰¹ä¸¹é£¯åº—', phone: '+81-956-27-0550', address: 'é•·å´ç¸£ä½ä¸–ä¿å¸‚è±ªæ–¯ç™»å ¡ç”º', mapLink: 'https://maps.app.goo.gl/HUISTENBOSCH_HOTEL' }, // [cite: 57]
                    [cite_start]{ name: 'åˆ¥åºœéµè¼ªæº«æ³‰ Spa Hotel é¶´è¦‹', phone: '+81-977-22-3301', address: 'å¤§åˆ†ç¸£åˆ¥åºœå¸‚é¶´è¦‹', mapLink: 'https://maps.app.goo.gl/BEPPU_TSURUMI_HOTEL' }, // [cite: 72]
                ]

                // æ¨¡æ“¬æ•¸æ“š: è³¼ç‰©æ¸…å–®
                const shoppingList = ref([
                    { name: 'ä¸€è˜­æ‹‰éºµæ³¡éºµ', purchased: false, image: null, notes: 'é€ç¦®ç”¨ï¼Œåœ¨ LaLaport æˆ–æ©Ÿå ´è²·' },
                    { name: 'è–¯æ¢ä¸‰å…„å¼Ÿ', purchased: false, image: null, notes: 'æ©Ÿå ´å…ç¨…åº—' },
                    { name: 'ç±³é£›å…”ç©å¶ (Miffy)', purchased: true, image: null, notes: 'è±ªæ–¯ç™»å ¡ç±³é£›åœ’å€é™å®šç‰ˆ' },
                ])

                const newShoppingItem = reactive({ name: '', image: null, notes: '' })
                
                // æ¨¡æ“¬æ•¸æ“š: èŠ±è²»è¨˜éŒ„
                const expensesList = ref([
                    { name: 'åˆé¤: æ¹¯å¸ƒé™¢æ–™ç†', category: 'é£²é£Ÿ', date: '2026-02-08', amount: 2200, paymentMethod: 'ç¾é‡‘', notes: 'é¤æ¨™' },
                    { name: 'è±ªæ–¯ç™»å ¡é–€ç¥¨', category: 'é–€ç¥¨', date: '2026-02-06', amount: 8000, paymentMethod: 'ä¿¡ç”¨å¡', notes: 'é ä»˜' },
                    { name: 'ç´€å¿µå“ (å¤©æ»¿å®®)', category: 'è³¼ç‰©', date: '2026-02-09', amount: 3500, paymentMethod: 'ç¾é‡‘', notes: 'æ¢…é¤…ã€å¾¡å®ˆ' },
                    { name: 'ä¸‰å¤§èŸ¹åƒåˆ°é£½ (è‡ªä»˜å·®é¡)', category: 'é£²é£Ÿ', date: '2026-02-08', amount: 6600, paymentMethod: 'ä¿¡ç”¨å¡', notes: 'åœ˜è²»å…§å«ï¼Œæ­¤ç‚ºå‡è¨­å€‹äººé¡å¤–å‡ç´šçš„è²»ç”¨' },
                ])

                const newExpenseItem = reactive({ name: '', category: '', date: new Date().toISOString().substring(0, 10), amount: null, paymentMethod: '', notes: '' })

                // --- Computed å±¬æ€§ ---
                
                // åŒ¯ç‡æ›ç®—
                const convertedTWD = computed(() => {
                    return jpyAmount.value * exchangeRate.twd
                })

                // èŠ±è²»ç¸½è¨ˆ
                const totalExpenseJPY = computed(() => {
                    return expensesList.value.reduce((sum, item) => sum + item.amount, 0)
                })

                const totalExpenseTWD = computed(() => {
                    return Math.round(totalExpenseJPY.value * exchangeRate.twd)
                })

                // è¡Œç¨‹éæ¿¾
                const filteredSchedule = computed(() => {
                    const currentDaySchedule = itinerary[activeDay.value].items
                    if (!filterCategory.value) {
                        return currentDaySchedule
                    }
                    return currentDaySchedule.filter(item => item.category === filterCategory.value)
                })

                // --- æ–¹æ³•/å‡½æ•¸ ---

                // å°èˆªåˆ° Google Maps
                const navigateToMap = (itemName) => {
                    if (itemName) {
                        const baseUrl = 'https://www.google.com/maps/dir/?api=1&destination='
                        const encodedName = encodeURIComponent('æ—¥æœ¬ä¹å· ' + itemName)
                        window.open(baseUrl + encodedName, '_blank')
                    }
                }

                // äº¤é€šæ™‚é–“è¨ˆç®— (æ¨¡æ“¬)
                const getTravelTime = (startItem, endItem) => {
                    // é€™è£¡æ‡‰å‘¼å« Google Maps Distance Matrix API
                    // ç”±æ–¼é€™æ˜¯ç´”å‰ç«¯ï¼Œæˆ‘å€‘ä½¿ç”¨æ¨¡æ“¬é‚è¼¯
                    const isDriving = endItem.travelTime.includes('directions_car')
                    const time = Math.random() * 60
                    const unit = time > 60 ? 'h' : 'm'
                    const displayTime = time > 60 ? (time / 60).toFixed(1) : Math.round(time)
                    const icon = isDriving ? 'directions_car' : (Math.random() < 0.5 ? 'directions_walk' : 'directions_bus')

                    return { travelTime: `${displayTime}${unit}`, transportIcon: icon }
                }

                // Modal ç›¸é—œ
                const showAddModal = (dayIndex) => {
                    currentEditItem.value = null
                    Object.assign(form, { name: '', category: '', openingHours: '', ticket: '', notes: '' })
                    currentEditDayIndex.value = dayIndex
                    currentEditItemIndex.value = null
                    showScheduleModal.value = true
                }

                const showEditModal = (dayIndex, itemIndex) => {
                    const item = itinerary[dayIndex].items[itemIndex]
                    currentEditItem.value = item
                    currentEditDayIndex.value = dayIndex
                    currentEditItemIndex.value = itemIndex
                    Object.assign(form, item)
                    showScheduleModal.value = true
                }

                const saveScheduleItem = () => {
                    const newItem = {
                        id: currentEditItem.value ? currentEditItem.value.id : Date.now(),
                        name: form.name,
                        category: form.category,
                        icon: getCategoryIcon(form.category),
                        openingHours: form.openingHours,
                        ticket: form.ticket,
                        notes: form.notes,
                        travelTime: 'å¾…è¨ˆç®—', // æ–°å¢æˆ–ç·¨è¼¯å¾Œéœ€è¦é‡æ–°è¨ˆç®—
                        transportIcon: '...',
                    }

                    if (currentEditItem.value) {
                        // ç·¨è¼¯æ¨¡å¼
                        Object.assign(itinerary[currentEditDayIndex.value].items[currentEditItemIndex.value], newItem)
                    } else {
                        // æ–°å¢æ¨¡å¼
                        itinerary[currentEditDayIndex.value].items.push(newItem)
                    }

                    // é‡æ–°è¨ˆç®—äº¤é€šæ™‚é–“ (æ­¤è™•ç‚ºæ¨¡æ“¬)
                    recalculateTravelTimes(currentEditDayIndex.value)
                    
                    showScheduleModal.value = false
                }
                
                const confirmDelete = () => {
                    showScheduleModal.value = false
                    showDeleteConfirm.value = true
                }

                const deleteScheduleItem = () => {
                    itinerary[currentEditDayIndex.value].items.splice(currentEditItemIndex.value, 1)
                    recalculateTravelTimes(currentEditDayIndex.value) // é‡æ–°è¨ˆç®—
                    showDeleteConfirm.value = false
                }
                
                const recalculateTravelTimes = (dayIndex) => {
                    const dayItems = itinerary[dayIndex].items
                    for (let i = 1; i < dayItems.length; i++) {
                        const prevItem = dayItems[i - 1]
                        const currentItem = dayItems[i]
                        // é€™è£¡æ‡‰æ˜¯å¯¦éš›çš„ API å‘¼å«ï¼Œç‚ºç°¡åŒ–ï¼Œæˆ‘å€‘åªæ›´æ–°æ¨¡æ“¬æ•¸æ“š
                        const { travelTime, transportIcon } = getTravelTime(prevItem, currentItem)
                        currentItem.travelTime = travelTime
                        currentItem.transportIcon = transportIcon
                    }
                }
                
                const getCategoryIcon = (category) => {
                    switch(category) {
                        case 'æ™¯é»': return 'location_on'
                        case 'ä½å®¿': return 'hotel'
                        case 'ç¾é£Ÿ': return 'restaurant'
                        case 'è³¼ç‰©': return 'shopping_bag'
                        case 'èˆªç­': return 'flight'
                        default: return 'edit_note'
                    }
                }

                const getCategoryBorder = (category) => {
                    switch(category) {
                        case 'äº¤é€š': return 'border-l-4 border-blue-400'
                        case 'é£²é£Ÿ': return 'border-l-4 border-red-400'
                        case 'ä½å®¿': return 'border-l-4 border-purple-400'
                        case 'é–€ç¥¨': return 'border-l-4 border-green-400'
                        case 'è³¼ç‰©': return 'border-l-4 border-yellow-400'
                        default: return 'border-l-4 border-gray-400'
                    }
                }

                // è³¼ç‰©æ¸…å–®æ“ä½œ
                const handleImageUpload = (event) => {
                    const file = event.target.files[0]
                    if (file) {
                        // å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæ‡‰å°‡åœ–ç‰‡ä¸Šå‚³è‡³ä¼ºæœå™¨ä¸¦å–å¾— URL
                        // æ­¤è™•ä½¿ç”¨ FileReader ç”¢ç”Ÿ Data URL é€²è¡Œå‰ç«¯é è¦½
                        const reader = new FileReader()
                        reader.onload = (e) => {
                            newShoppingItem.image = e.target.result
                        }
                        reader.readAsDataURL(file)
                    }
                }

                const addShoppingItem = () => {
                    shoppingList.value.push({
                        name: newShoppingItem.name,
                        purchased: false,
                        image: newShoppingItem.image,
                        notes: newShoppingItem.notes,
                    })
                    // é‡ç½®è¡¨å–®
                    Object.assign(newShoppingItem, { name: '', image: null, notes: '' })
                    showShoppingModal.value = false
                }
                
                const removeShoppingItem = (index) => {
                    if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${shoppingList.value[index].name}ã€å—ï¼Ÿ`)) {
                        shoppingList.value.splice(index, 1)
                    }
                }

                // èŠ±è²»è¨˜éŒ„æ“ä½œ
                const addExpenseItem = () => {
                    expensesList.value.unshift({ // unshift è®“æœ€æ–°ç´€éŒ„åœ¨æœ€ä¸Šé¢
                        name: newExpenseItem.name,
                        category: newExpenseItem.category,
                        date: newExpenseItem.date,
                        amount: newExpenseItem.amount,
                        paymentMethod: newExpenseItem.paymentMethod,
                        notes: newExpenseItem.notes,
                    })
                    // é‡ç½®è¡¨å–®ï¼Œæ—¥æœŸè‡ªå‹•å¸¶å…¥ç•¶æ—¥
                    Object.assign(newExpenseItem, { name: '', category: '', amount: null, paymentMethod: '', notes: '', date: new Date().toISOString().substring(0, 10) })
                    showExpenseModal.value = false
                }

                // é¦–æ¬¡è¼‰å…¥æ™‚ï¼Œç‚ºæ‰€æœ‰è¡Œç¨‹è¨­å®š ICON (åƒ…ä¸€æ¬¡)
                itinerary.forEach(day => {
                    day.items.forEach(item => {
                        item.icon = getCategoryIcon(item.category)
                        // ç¢ºä¿æ‰€æœ‰éèˆªç­é …ç›®æœ‰ travelTime å’Œ transportIcon çš„æ¨¡æ“¬æ•¸æ“š
                        if (!item.isFlight) {
                             const { travelTime, transportIcon } = getTravelTime(null, null)
                             item.travelTime = item.travelTime || travelTime
                             item.transportIcon = item.transportIcon || transportIcon
                        }
                    })
                })
                
                // --- è¿”å›çµ¦æ¨¡æ¿çš„æ•¸æ“šå’Œæ–¹æ³• ---
                return {
                    // Ref/Reactive Data
                    activeTab, activeDay, tabs, itinerary, filterCategory, categories, expenseCategories,
                    flightInfo, accommodationInfo, jpyAmount, exchangeRate,
                    shoppingList, newShoppingItem, expensesList, newExpenseItem,
                    showScheduleModal, showShoppingModal, showExpenseModal, showDeleteConfirm,
                    form, currentEditItem,

                    // Computed
                    convertedTWD, totalExpenseJPY, totalExpenseTWD, filteredSchedule,

                    // Methods
                    navigateToMap, showAddModal, showEditModal, saveScheduleItem, confirmDelete, deleteScheduleItem,
                    handleImageUpload, addShoppingItem, removeShoppingItem, addExpenseItem, getCategoryBorder
                }
            }
        })

        app.mount('#app')
    </script>
</body>
</html>